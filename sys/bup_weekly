#!/bin/bash
# Backup hebdomadaire
# Récupération avec : tar -xzvf <archive.tar.gz>

# Définition du dossier de sauvegarde hebdomadaire
[ -d "$HOME/Documents/Backups/2-hebdo" ] || mkdir -p "$HOME/Documents/Backups/2-hebdo"

# Création du dossier
BDIR="$HOME/Documents/Backups/2-hebdo/bup_$(date +%Y-%m-%d)"
mkdir -p "$BDIR"
host="${HOST:-art}"
user="${USER:-cf}"

# Chemins des dossiers à sauvegarder dans des tableaux
DAT=(
	"$XDG_CONFIG_HOME/shell"
	"$XDG_CONFIG_HOME/x11"
	"$XDG_CONFIG_HOME/dunst"
	"$XDG_CONFIG_HOME/gh"
	"$XDG_CONFIG_HOME/nvim/after"
	"$XDG_CONFIG_HOME/nvim/lua"
	"$XDG_CONFIG_HOME/nvim/"
	"$XDG_CONFIG_HOME/zsh"
	"$XDG_CONFIG_HOME/mpd"
	"$XDG_CONFIG_HOME/pulsemixer.config"
	"$XDG_CONFIG_HOME/lf"
	"$XDG_CONFIG_HOME/nsxiv"
	"$XDG_CONFIG_HOME/wireplumber"
	"$XDG_CONFIG_HOME/pipewire"
	"$XDG_CONFIG_HOME/newsboat"
	"$XDG_CONFIG_HOME/abook"
	"$XDG_CONFIG_HOME/mu4e"
	"$XDG_CONFIG_HOME/msmtp"
	"$XDG_CONFIG_HOME/mbsync"
	"$XDG_CONFIG_HOME/ueberzugpp"
	"$XDG_CONFIG_HOME/polybar"
	"$XDG_CONFIG_HOME/walfeh"
	"$XDG_CONFIG_HOME/transmmission"
	"$XDG_CONFIG_HOME/transmmission-daemon"
	"$XDG_CONFIG_HOME/gcolor3"
	"$XDG_CONFIG_HOME/surfraw"
	"$XDG_CONFIG_HOME/syngestures.toml"
	"$XDG_CONFIG_HOME/libinput-gestures.conf"
	"$XDG_CONFIG_HOME/mimeapps.list"
	"$XDG_CONFIG_HOME/zinger"
	"$XDG_CONFIG_HOME/ookla"
	"$XDG_CONFIG_HOME/fontconfig"
	"$XDG_CONFIG_HOME/htop"
	"$XDG_CONFIG_HOME/ncmpcpp"
	"$XDG_CONFIG_HOME/ipwebtv"
	"$XDG_CONFIG_HOME/user-dirs.dirs"
	"$XDG_CONFIG_HOME/trizen"
	"$XDG_CONFIG_HOME/mpv"
	"$XDG_CONFIG_HOME/ytfzf"
	"$XDG_CONFIG_HOME/zathura"
	"$XDG_CONFIG_HOME/qutebrowser/userscripts"
	"$XDG_CONFIG_HOME/qutebrowser/config.py"
        "$HOME/.emacs.d/init.el"
        "$HOME/.emacs.d/early-init.el"
        "$HOME/.emacs.d/eww-bookmarks"
        "$HOME/.emacs.d/bookmarks"
	"$XDG_DATA_HOME/password-store"
	"$XDG_DATA_HOME/gnupg"
	"$XDG_DATA_HOME/keyrings"
	"$XDG_DATA_HOME/calcurse"
	"$XDG_DATA_HOME/qutebrowser"
	"$HOME/.ssh"
	"$HOME/.local/bin"
	"$HOME/Templates/html/startpage"
	"$HOME/Templates/css"
	"$HOME/Templates/settings"
	"$HOME/Templates/c"
	"$HOME/Documents/Agenda"
	"$HOME/Documents/org"
	"$HOME/Documents/dc"
	"$HOME/Documents/Notes"
	"$HOME/.local/mail"
	"$HOME/.local/keys"
)

# for f in dwm dmenu st xmouseless dwmblocks dragon x2x ; do
#          find ~/.local/src/"$f" -type f -name "*.[h,c,o,m,m,s,1]*" -not -path "*.git*" -exec echo "\"{}\"" \; | sed 's/\/home\/cf/\$HOME/' | sort -u
# done
SRC=(
	"$HOME/.local/src/dwm/swallow_scripts"
	"$HOME/.local/src/dwm/LICENSE"
        "$HOME/.local/src/dwm/README.md"
        "$HOME/.local/src/dwm/README.org"
        "$HOME/.local/src/dwm/config.h"
        "$HOME/.local/src/dwm/config.mk"
        "$HOME/.local/src/dwm/drw.c"
        "$HOME/.local/src/dwm/drw.h"
        "$HOME/.local/src/dwm/drw.o"
        "$HOME/.local/src/dwm/dwm.1"
        "$HOME/.local/src/dwm/dwm.c"
        "$HOME/.local/src/dwm/dwm.o"
        "$HOME/.local/src/dwm/larbs.mom"
        "$HOME/.local/src/dwm/shiftview.c"
        "$HOME/.local/src/dwm/test.sh"
        "$HOME/.local/src/dwm/transient.c"
        "$HOME/.local/src/dwm/trwicon.c"
        "$HOME/.local/src/dwm/util.c"
        "$HOME/.local/src/dwm/util.h"
        "$HOME/.local/src/dwm/util.o"
        "$HOME/.local/src/dwm/vanitygaps.c"
        "$HOME/.local/src/dmenu/README.md"
        "$HOME/.local/src/dmenu/arg.h"
        "$HOME/.local/src/dmenu/config.h"
        "$HOME/.local/src/dmenu/config.mk"
        "$HOME/.local/src/dmenu/dmenu.1"
        "$HOME/.local/src/dmenu/dmenu.c"
        "$HOME/.local/src/dmenu/dmenu.o"
        "$HOME/.local/src/dmenu/drw.c"
        "$HOME/.local/src/dmenu/drw.h"
        "$HOME/.local/src/dmenu/drw.o"
        "$HOME/.local/src/dmenu/stest.1"
        "$HOME/.local/src/dmenu/stest.c"
        "$HOME/.local/src/dmenu/stest.o"
        "$HOME/.local/src/dmenu/util.c"
        "$HOME/.local/src/dmenu/util.h"
        "$HOME/.local/src/dmenu/util.o"
        "$HOME/.local/src/st/README.md"
        "$HOME/.local/src/st/arg.h"
        "$HOME/.local/src/st/boxdraw.c"
        "$HOME/.local/src/st/boxdraw.o"
        "$HOME/.local/src/st/boxdraw_data.h"
        "$HOME/.local/src/st/config.def.h"
        "$HOME/.local/src/st/config.h"
        "$HOME/.local/src/st/config.mk"
        "$HOME/.local/src/st/hb.c"
        "$HOME/.local/src/st/hb.h"
        "$HOME/.local/src/st/hb.o"
        "$HOME/.local/src/st/st.1"
        "$HOME/.local/src/st/st.c"
        "$HOME/.local/src/st/st.h"
        "$HOME/.local/src/st/st.o"
        "$HOME/.local/src/st/win.h"
        "$HOME/.local/src/st/x.c"
        "$HOME/.local/src/st/x.o"
        "$HOME/.local/src/xmouseless/README.md"
        "$HOME/.local/src/xmouseless/config.h"
        "$HOME/.local/src/xmouseless/xmouseless.c"
        "$HOME/.local/src/dwmblocks/README.md"
        "$HOME/.local/src/dwmblocks/blocks.def.h"
        "$HOME/.local/src/dwmblocks/blocks.h"
        "$HOME/.local/src/dwmblocks/dwmblocks.c"
        "$HOME/.local/src/dwmblocks/patches/blocks.h"
        "$HOME/.local/src/dwmblocks/patches/config.h.old"
        "$HOME/.local/src/dragon/dndst.c"
        "$HOME/.local/src/dragon/dragon.1"
        "$HOME/.local/src/dragon/dragon.c"
        "$HOME/.local/src/dragon/dragst.c"
        "$HOME/.local/src/dragon/example/download.sh"
        "$HOME/.local/src/x2x/ChangeLog.old"
        "$HOME/.local/src/x2x/README.md"
        "$HOME/.local/src/x2x/aclocal.m4"
        "$HOME/.local/src/x2x/autom4te.cache/output.1"
        "$HOME/.local/src/x2x/autom4te.cache/traces.1"
        "$HOME/.local/src/x2x/bootstrap.sh"
        "$HOME/.local/src/x2x/config.h"
        "$HOME/.local/src/x2x/config.h.in"
        "$HOME/.local/src/x2x/config.status"
        "$HOME/.local/src/x2x/keymap.c"
        "$HOME/.local/src/x2x/keymap.h"
        "$HOME/.local/src/x2x/lawyerese.c"
        "$HOME/.local/src/x2x/lawyerese.o"
        "$HOME/.local/src/x2x/nocursor.cur"
        "$HOME/.local/src/x2x/resource.h"
        "$HOME/.local/src/x2x/winmsg.c"
        "$HOME/.local/src/x2x/x2x.1"
        "$HOME/.local/src/x2x/x2x.c"
        "$HOME/.local/src/x2x/x2x.o"
)

# Création des archives
sudo tar -zcvf "$BDIR/${host}_${user}_data_$(date +%Y-%m-%d).tar.gz" -C / "${DAT[@]}"
sudo tar -zcvf "$BDIR/${host}_${user}_src_$(date +%Y-%m-%d).tar.gz" -C / "${SRC[@]}"

# Trouver les dossiers plus vieux que 31 jours et les supprimer
sudo find "$HOME/Documents/Backups/2-hebdo" -type f -mtime +31 -delete
sudo find "$HOME/Documents/Backups/2-hebdo" -type d -mtime +31 -delete
